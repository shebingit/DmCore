{% extends 'TC_base.html' %}
{% load static %}
{% block body %}
<style>
  @media screen and (max-width: 768px){
    #btn1{
      width: 100% !important;
    }

  }
</style>
<div>
  <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a class="text-underline-remove" href="{% url 'TC_dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item " aria-current="page"><a class="text-underline-remove" href="{% url 'TC_current_clients' %}"> current Clients </a></li>
        <li class="breadcrumb-item active text-md" aria-current="page">OnGoing Leads</li>
      </ol>
    </nav>
</div>
<div class="container-fluid card">

  <div class="card-body">
    <div class="table-responsive">
      <table class="table" id="leave-datatable">
            <thead>
              <tr>
                <th scope="col"><b>ID</b></th>
                <th scope="col"><b>Next Update Date</b></th>
                <th scope="col"><b>Name</b></th>
                <th scope="col"><b>Email</b></th>
      
                <th scope="col"><b>Contact</b></th>
                <th scope="col"><b>Status</b></th>
                <th scope="col"><b>More</b></th>
                <th scope="col"><b>Action</b></th>
      
              </tr>
            </thead>
            <tbody>
              {% for d in data %}
      
              <tr>
                <td class="text-white">{{d.id}}</td>
                  
                    <td class="text-white">{{d.Next_update_date}}</td> 
                  
                     
                <td><b><a href="" class="text-white">{{d.leadId.lead_name}}</a></b></td>
                <td class="text-white">{{d.leadId.lead_email}}</td>
                <td class="text-white">{{d.leadId.lead_contact}}</td>
                {% if d.Response == 'waiting' %}
                <td><div class="badge badge-outline-warning"  id="btn1">waiting</div></td>
                
                {% elif d.Update_Action == 0 %}
                <td><div class="badge badge-outline-success"  id="btn1"><span class="text-small">New One</span></div></td>
                {% else %}
              
                  <td><div class="badge badge-outline-warning"  id="btn1"><span class="text-small">{{d.Response}}</span></div></td>
                
                {% endif %}
               
      
                <td class="text-white"><a href="" class="btn btn-outline-primary" data-toggle="modal"
                  data-target="#myModal2{{d.id}}"><span class="text-small">View Details</span> </a></td>
  
                
  
                <td class="text-white"><a href="" class="btn btn-outline-warning" data-toggle="modal"
                    data-target="#myModal{{d.id}}"><span class="text-small">Mark Response</span> </a></td>
      
      
              </tr>
  
              <!--Response Modal -->
              <div class="modal fade" id="myModal2{{d.id}}" role="dialog">
                <div class="modal-dialog">
      
                  <!-- Modal content-->
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title text-center" >Clients Response</h4>
                      <button type="button" class="close text-danger" data-dismiss="modal" style="justify-content: end;">&times;</button>
                      
                    </div>
                    <div class="modal-body">
                      <div class="row p-2">
                        <div class="col">Response</div>
                        <div class="col">: <b>{{d.Response}}</b></div>
                      </div>
                      <div class="row p-2">
                        <div class="col">Reason</div>
                        <div class="col">: <b>{{d.Reason}}</b></div>
                      </div>
                      {% for m in more %}
                     
                      {% if m.leadId.id == d.leadId.id %}
                      <div class="row p-2">
                        <div class="col">{{m.lead_field_name}}</div>
                        <div class="col">: <b>{{m.lead_field_data}}</b></div>
                      </div>
                      {% endif %}
                      {% endfor%}
  
                      {% for r in record %}
                      {% if r.Record %}
                      {% if r.Leads_assignto_tc_id.id == d.id %}
                      
                      <div class="row p-2 pt-4">
                        <audio controls>
                          <source src="{{r.Record.url}}">
                        </audio>
                      </div>
                      {% endif %}
                      {% endif %}
                      {% endfor %}
                    </div>
                    
                   
                    <div class="modal-footer">
                      
                      
                      <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                  </div>
      
                </div>
              </div>
  
  
  
  
              <!--Update Modal -->
              <div class="modal fade" id="myModal{{d.id}}" role="dialog">
                <div class="modal-dialog">
      
                  <!-- Modal content-->
                  <div class="modal-content">
                    <div class="card">
                      <div class="card-head d-flex justify-content-between align-items-center mt-3 mb-0 ">
                        <h4 class="card-title mt-3 ml-3">Update Clients Response </h4>
                        <span class="mdi mdi-close-box mdi-18px text-danger mr-2"  data-dismiss="modal"></span>
                      </div>
                      <div class="card-body mt-0" style="padding: 0.25rem 0.5625rem">
                    
                   
                      <form action="{% url 'TC_update_Clients_Response' d.id %}" method="post"  enctype="multipart/form-data">
                        {% csrf_token %} 
                        <div class="row">
                          <div class="col">
                            <p>Name</p>
                          </div>
                          <div class="col">
                            <p>: {{d.leadId.lead_name}}</p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <p>Email</p>
                          </div>
                          <div class="col">
                            <p>: {{d.leadId.lead_email}}</p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <p>Contact</p>
                          </div>
                          <div class="col">
                            <p>: {{d.leadId.lead_contact}}</p>
                          </div>
                        </div>
                        <select name="Response" id="response" class="form-control text-white p-2" 
                          required>
                          <option value="">choose Response</option>
                          {% for response in flstatus %}
                          <option value="{{ response.status_name }}" class="text-white">{{ response.status_name }}</option>
                          {% endfor %}
                         
                        </select>
                        <label style="font-size: 15px;margin-top: 5px;">Next Update Date*</label>
                        <input type="date"  id="nud" name="nud" class="form-control  text-white">
                        <!-- <input type="text" placeholder="Enter Response" class="form-control mt-3"> -->
                        <textarea type="text" placeholder="enter Reason" name="Reason" class="form-control mt-3 text-white" style="height: 100px;" required></textarea>
  
                        <label style="font-size: 15px;margin-top: 5px;">Call Record*</label>
                        <input type="file" class="form-control text-offwhite" name="record" accept="audio/*">
                        <div class="d-flex justify-content-center mt-3 mb-2">
                          <button type="submit" class="btn btn-outline-success   mr-2"><span class="text-small">Update</span></button>
                          <a href="{% url 'TC_waste_leads_action' d.leadId.id %}" class="btn btn-outline-warning text-small mr-2"><span class="text-small">waste Lead</span> </a>
                          <button type="button" class="btn btn-outline-danger text-small" data-dismiss="modal"><span class="text-small">Close</span></button>
                        </div>
                       
                      </form>
                      </div>
                    </div>
                   
                  </div>
      
                </div>
              </div>
  
              <script>
                var a ="{{i.id }}"
                $(document).ready(function(){
                  $("#myBtn"+a).click(function(){
                  $("#myModal"+a).modal({show:true});
                });
              
                });
              </script>
              <script>
                var a ="{{i.id }}"
                $(document).ready(function(){
                  $("#myBtn2"+a).click(function(){
                  $("#myModal2"+a).modal({show:true});
                });
              
                });
              </script>
              {% endfor %}
      
            </tbody>
          </table>
        </div>

  </div>

 
    
</div>




{% endblock %}