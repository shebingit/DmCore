{% extends 'TC_base.html' %}
{% load static %}
{% block body %}

<link href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css"  rel="stylesheet" >
<link rel="stylesheet" href="{% static 'css/TeamLead/style.css' %}">



<!----------------------------------- Body Section ------------------------------------------------------------------->

<div>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a class="text-underline-remove" href="{% url 'TC_dashboard' %}">Dashboard</a></li>
      <li class="breadcrumb-item"><a class="text-underline-remove" href="{% url 'TC_newleads' %}">Followup Leads</a></li> 
    </ol>
  </nav>
</div>



<div class="row ">
  <div class="col-12 grid-margin">
    <div class="card">
      <div class="card-body">
        <h6 class="card-title text-offwhite"> Followup -  ( <span id="lead-count">{{dataBank_count}}</span>  )</h6>
          <div class="form-section">
             
              <div>
                <form action="{% url 'DAM_Dashboard_databank' %}" method="post" class="search-form">
                  {% csrf_token%}
                 

                  <div class="input-groupBox">
                    <select name="pgnum" >
                      <option value="" >All</option>
                      {% if pg_num %}
                      <option value="{{pg_num}}" selected>{{pg_num}}</option>
                      {% endif %}
                      <option value="20">20</option>
                      <option value="25">25</option>
                      <option value="50">50</option>
                      <option value="100">100</option>
                      <option value="250">250</option>
                      <option value="500">500</option>
                      <option value="1000">1000</option>
                    </select>
                  </div>
                 
                  <div class="input-groupBox">
                    <select name="client_id" id="client-change">
                      <option value="">select client</option>
                      {% for client in clients_objs %}
                      <option value="{{ client.client_Id.id }}"> {{ client.client_Id.client_name }}</option>
                      {% endfor %}
                
                    </select>
                  </div>

                  <div class="input-groupBox">
                    <select name="category" id="lead-category">
                      <option value="">select category</option> 
                    </select>
                  </div>
                  
                  <div class="input-groupBox">
                    <select name="executive"  id="lead-executive">
                      <option value="">select executive </option> 
                    </select>
                  </div>
                 
                  <div class="input-groupBox">
                    <input type="date" name="sdate" id="s-date" {% if d1 %} value="{{d1}}" {% endif %}>
                  </div>
                  <div class="input-groupBox">
                    <input type="date" name="edate" id="e-date" {% if d2 %} value="{{d2}}" {% endif %}>
                  </div>
                  <div class="input-groupBox">
                    <select name="status_val" >
                      <option value="">select status</option>
                      <option value="Not Attended">Not Attended</option>
                      <option value="Allocated">Allocated</option>
                      <option value="Opend">Opend</option>
                      <option value="Closed">Closed</option>
                    </select>
                  </div>
                  
                 
                  <div class="search-box">
                    <button type="submit"><span class="mdi mdi-magnify"></span></button>
                  </div>
                </form>
              </div>
            
          </div>
    

        <div class="table-responsive">
          <table class="table table-bordered" id="leads-wastedata">
            <thead>
              <tr>
                <th> No</th>
                <th></th>
                <th> Add Date</th>
                <th> Name </th>
                <th> Email id </th>
                <th> Contact </th>
                <th> Response </th>
               
              </tr>
            </thead>
            <tbody id="waste-lead-body">
              {% for db_lead in dataBank_objs %}
              <tr class="clickable-row" data-href="{% url 'lead_track' db_lead.id  %}"> 
                <td>{{ forloop.counter }}</td>
                <td>
                  <a href="{% url 'Lead_FollowUp_Updates' db_lead.id %}" class="text-secondary">
                    <span class="mdi mdi-phone-forward mdi-18px"></span> 
                  </a>
                </td>
                
                <td>{{ db_lead.Assign_Date |date:"d-M-y" }}</td>
                <td><span class="mdi mdi-account pl-1"></span> {{ db_lead.leadId.lead_name}}  {{ db_lead.id}}</span>
                  
                 </td>
                <td><span class="mdi mdi-email pl-1"></span> {{ db_lead.leadId.lead_email}}</td>
                <td><span class="mdi mdi-phone pl-1"></span> {{ db_lead.leadId.lead_contact}}</td>
                <td>
                  
                  <span class="badge badge-pill  badge-outline-secondary">
                   {{ db_lead.dataBank_ID.Response }} 
                  
                </td>
                
              </tr>
              {% endfor %}
            
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>



<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


<script>
  $(document).ready(function() {
     new DataTable('#leads-wastedata', {
         search: {
          enable: true 
         },
         columnDefs: [
         {
             orderable: false,
             className: 'check-single',
             targets: 0,
         }
     ],
     
     
 });

});
</script>


<div class="card">

  <div class="card-body">
    <div class="row">
      <div class="col-sm-12 col-lg-8 col-md-8 col-xl-9  grid-margin">
        <h6 class="card-title custom-letter-spacing"> Follow Up Leads List - ( <span > {{leads_obj_count }} </span> )</h6>
      </div>

    </div>
    <div class="table-responsive">
      {% if messages %}
                
      {% for message in messages %}
      <div class="alert alert-fill-success" role="alert">
        <i class="mdi mdi-check-circle"></i> {{ message }}
      </div>
      
      {% endfor %}
                 
      {% endif %}
      <table class="table  table-bordered table-hover" >
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Client Name \ Lead Category</th>
            <th scope="col">Name</th>

            <th scope="col">Next Update Date</th>
            <th scope="col">Status</th>
            <th scope="col">Follow up</th>
          </tr>
        </thead>
        <tbody>
          {% for d in dataBank_objs %}

          {% if d.Next_update_date < t_date %}
           <tr class="bg-danger ">
              <td class="">{{forloop.counter }}</td>
              
              <td class="">
                <p class=" mt-2 mb-2"> {{d.leadId.lead_work_regId.clientId.client_name}} </p>
                <p class="mt-2 mb-2"> {{d.leadId.lead_category_id.lead_collection_for}} </p>
                <p class="mt-3 text-offwhite"> Allocated on : {{d.Assign_Date}} </p>
              </td>
              
              <td>
                <p class="text-offwhite">{{d.leadId.lead_name}}</p>
                <p class=" mt-2 mb-2">{{d.leadId.lead_email}}</p>
                <p>{{d.leadId.lead_contact}}</p>
              </td>
              
              
              
              <td class="">{{d.Next_update_date | default:'No date available'}}</td>
              
             
              <td class="text-center">
                {% if d.Update_Action == 0 %}
                <div class="badge badge-outline-success" id="btn1"><span class="text-small">New Lead</span></div>
             
                {% else %}
              
                <div class="badge badge-outline-warning" id="btn1"><span class="text-small">{{d.Response}}</span></div>
                {% endif %}
              </td>
              
             
              
              <td class="text-white text-center">
                <a href="{% url 'Lead_FollowUp_Updates' d.id %}" class="btn btn-success p-2"><span class="mdi mdi-phone"></span> </a>
              </td>

            </tr>
            {% elif d.Next_update_date == t_date %}
              <tr class="bg-warning">
                <td class="">{{forloop.counter }}</td>
                <td class="">
                  <p class=""> {{d.leadId.lead_work_regId.clientId.client_name}} </p>
                  <p class="mt-2 mb-2"> {{d.leadId.lead_category_id.lead_collection_for}} </p>
                  <p class="mt-3 text-offwhite"> Allocated on : {{d.Assign_Date}} </p>
                </td>

                <td>
                  <p class="text-offwhite">{{d.leadId.lead_name}}</p>
                  <p class=" mt-2 mb-2">{{d.leadId.lead_email}}</p>
                  <p>{{d.leadId.lead_contact}}</p>
                </td>



                <td class="">{{d.Next_update_date | default:'No date available'}}</td>

              
                <td class="text-center">
                  {% if d.Update_Action == 0 %}
                  <div class="badge badge-outline-success" id="btn1"><span class="text-small">New Lead</span></div>
              
                {% else %}

                  <div class="badge badge-outline-secondary" id="btn1"><span class="text-small">{{d.Response}}</span>
                  </div>
                  {% endif %}
                </td>

              



                <td class="text-white text-center">
                  <a href="{% url 'Lead_FollowUp_Updates' d.id %}" class="btn btn-success p-2"><span
                      class="mdi mdi-phone"></span> </a>
                </td>



              </tr>
            {% else %}
              <tr class="text-offwhite">
                <td class="">{{forloop.counter }}</td>
                <td class="">
                  <p class=""> {{d.leadId.lead_work_regId.clientId.client_name}} </p>
                  <p class="mt-2 mb-2"> {{d.leadId.lead_category_id.lead_collection_for}} </p>
                  <p class="mt-3 text-offwhite"> Allocated on : {{d.Assign_Date}} </p>
                </td>


                <td>
                  <p class="text-offwhite">{{d.leadId.lead_name}}</p>
                  <p class=" mt-1 mb-2">{{d.leadId.lead_email}}</p>
                  <p>{{d.leadId.lead_contact}}</p>
                </td>


                <td class="">{{d.Next_update_date | default:'No date available'}}</td>

             
                <td class="text-center">
                  {% if d.Update_Action == 0 %}
                  <div class="badge badge-outline-success" id="btn1"><span class="text-small">New Lead</span></div>
               
                {% else %}
    
                  <div class="badge badge-outline-warning" id="btn1"><span class="text-small">{{d.Response}}</span></div>
                {% endif %}
                </td>

               



                <td class="text-white text-center">
                  <a href="{% url 'Lead_FollowUp_Updates' d.id %}" class="btn btn-success p-2"><span
                      class="mdi mdi-phone"></span> </a>

                </td>

              </tr>
            {% endif %}

            {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-----------------------------------Scripts Section ------------------------------------------------------------------->






{% endblock %}


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap4.min.js"></script>

<script>
  $(document).ready(function () {
    new DataTable('#data-table');

  });
  $(document).ready(function() {
    // Hide the alert after 3 seconds
    setTimeout(function() {
        $(".alert").fadeOut("slow");
    }, 3000); // 3000 milliseconds = 3 seconds
  });
  
</script>

<!----------------------------------- Style Section ------------------------------------------------------------------->
<style>
  .bg-danger {
    background-color: #f50a168a !important;
    color: rgb(225, 226, 226);
  }

  .bg-warning {
    background-color: #ffca09a3 !important;
    color: rgb(225, 226, 226);
  }

  .bg-danger a,
  .bg-warning a {
    color: rgb(225, 226, 226);
  }

  /*Pagination Styling */

  div.dataTables_wrapper div.dataTables_paginate ul.pagination {
    margin: 1rem 0.5rem;
    white-space: nowrap;
    justify-content: flex-end;
  }

  div.dataTables_wrapper div.dataTables_paginate ul.pagination li a {
    border: none !important;
    color: #c9c9c9;
    font-size: 13px;
  }

  div.dataTables_wrapper div.dataTables_paginate ul.pagination li:hover a {
    background: #dc1a1a !important;
    color: #f8f7f7;
  }
  .alert-fill-success {
    color: white;
    background: #00d25b;
  }
  .alert-fill-danger {
  color: white;
  background: #fc424a;
  }
  .alert {
    font-size: 0.795rem;
  }
  #data-table_previous {
    color: #0000 !important;
  }
</style>