{% extends 'HD_base.html' %}
{% load static %}
{% load custom_filters %}
{% block body %}
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css">

<style>
    .input-textarea textarea
    {
        color: #c8c8c8;
    }
    .ml-2
    {
        margin-right: 0.40rem;
    }
    .dt-search label
    {
     display: none;

    }
    div.dt-container .dt-search input {
        border: 1px solid #707070;
        border-radius: 3px;
        padding: 5px;
        background-color: transparent;
        color: #a5a5a5;
        margin-left: 3px;
        font-size: 13px;
    }

    div.dt-container select.dt-input {
        padding: 4px 10px;
        border: 1px solid #707070;
        color: #a5a5a5;
        font-size: 13px;
        background-color: transparent;
        width: 100px;
    }
    div.dt-container select option{
        background-color: #15171f; 
    }
    div.dt-container .dt-length label
    {
        display: none;
    }
    div.dt-container .dt-info
    {
        color: #a5a5a5;
        font-size: 13px 
    }
</style>

<div>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a class="text-underline-remove" href="{% url 'head_waste_lead' %}">Waste Leads</a></li>
          <li class="breadcrumb-item active text-md" aria-current="page"> Data Manager </li>
        </ol>
      </nav>
</div>

<div class="row mt-1">
    <div class="col-12 grid-margin">
        <div class="card">
            <div class="card-body">

            
            
            {% if leads_obj %}
    
                <div class="row">
                    <div class="col-sm-12 col-lg-8 col-md-7 col-xl-9  grid-margin">
                    <h6 class="card-title custom-letter-spacing"> Waste Leads List - ( {{ leads_obj_count }} )</h6>
                    </div>
                   
                    
                </div>
        
                <div class="table-responsive">
                    <table class="table" id="leads-data">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th> History </th>
                            <th>Lead Name</th>
                            <th>Contact Details</th>
                           
                        </tr>
                    </thead>
                    <tbody>
                        {% for lead in leads_obj %}
                        <tr>
                            <td><span>{{ forloop.counter }}</span> </td>
                            <td>

                                <a class="small ml-2 btn btn-sm btn-outline-info fetch-lead-details"  data-lead-id="{{ lead.id }}" title="More Details of Lead">
                                    <span class="mdi mdi-file-document mdi-18px text-secondary">  </span> 
                                </a>
                                
                            </td>
                            <td>
                                <p><span class="mdi mdi-account ml-2"></span> {{ lead.leadId.lead_name }}</p>
                                <p> <span class="mdi mdi-file-document  ml-2"></span>
                                    {{ lead.client_id.client_name }} - 
                                     {{ lead.leadId.lead_category_id.lead_collection_for }}</p>
                            </td>
                            <td>
                                <p><span class="mdi mdi-email ml-2"></span>{{ lead.leadId.lead_email }}</p>
                                <p><span class="mdi mdi-phone ml-2"></span>{{ lead.leadId.lead_contact }}</p>
                            </td>
                           
                        </tr>
                        {% endfor %}
                    
                    </tbody>
                    </table>
                </div>

            {% else %}
            
                <div class="d-flex justify-content-center">
                <img src="{% static 'images\file-icons\no-data-file.png' %}">
                </div>
            
            {% endif %}
                        
                        
            </div>
        </div>
    </div>
</div>



<style>
    .activityBox
    {
        background-color: #21272dfb;
    }
    .activityBox .modal-title
    {
        font-size: 14px;
        letter-spacing: 1px;
        font-weight: 400;
        color: #c0c0c0;
    }
    .activity-MainBox
    {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 0.50rem;
    }
    .activity-MainBox .basic-details
    {
        border-bottom: 1px solid rgb(201, 201, 201); 
        margin-bottom: 1rem;
    }
    .activity-leftBox h6,
    .activity-rightBox h6
   {
        font-size: 13.8px;
        letter-spacing: 1px;
        color: #c0c0c0;
    }
    .activity-leftBox p{
        color: #979797;
    }
    .activity-panel
    {
        border-top: 1px solid rgb(201, 201, 201); 
        display: grid;
        grid-template-columns: 2.5fr 1fr;
    }
    .collect-history
    {
        padding-left: 0.80rem;
    }
    .activity-history h5,
    .collect-history h5{
        font-size: 12.7px;
        letter-spacing: 1px;
        color: #d1d1d1;
        margin-top: 1rem;
    }
    .lead-more-details
    {
        height: 200px;
        overflow-y: scroll;
    }
    .Collected-details p{
        font-size: 12px;
        color: #b3b3b3;
    }
    .history-track
    {
        height: 320px;
        overflow-y: scroll;
    }
    .waste-reason p{
        font-size: 12.5px;
        color: #bdbdbd;
    }
    .lead-more-details::-webkit-scrollbar,
    .history-track::-webkit-scrollbar
     {
        width: 1px; /* Set the width of the scrollbar */
    }
    
    /* For webkit browsers */
    .lead-more-details::-webkit-scrollbar-track,
    .history-track::-webkit-scrollbar-track {
        background: transparent; /* Set the background color of the track */
    }
    
    /* For webkit browsers */
    .lead-more-details::-webkit-scrollbar-thumb,
    .history-track::-webkit-scrollbar-thumb {
        background: #888; /* Set the color of the scrollbar thumb */
        border-radius: 10px; /* Set the border radius of the scrollbar thumb */
    }
    .lead-more-details .more-details
    {
        display: grid;
        grid-template-columns: 1fr 10px 1fr;
    }
    .followup-details
    {
        border-bottom: 1px solid rgb(165, 165, 165); 
       
        margin-top: 0.40rem;
       
    }
    .followup-details p,
    .followup-history p{
        font-size: 12.5px;
        color: #d5d5d5;
    }
    .followup-details .top-details,
    .followup-history .top-details
    {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }
    .waste-reason-ststus
    {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
    }
    .history-div
    {
        border-bottom: 1px solid rgb(150, 150, 150);
        padding: 10px 5px; 
    }
    @media (max-width:1032px)
    {
        .activity-MainBox
        {
            grid-template-columns: 1fr;
           
        }
    }
    @media (max-width:632px)
    {
    .activity-panel {
        
        grid-template-columns:1fr;
    }
    .waste-reason-ststus
    {
        grid-template-columns:1fr;
    }
    .modal-footer {
        flex-wrap: nowrap
    }
}
</style>

<!-- Modal -->
<div class="modal fade" id="activityPanel" tabindex="-1" aria-labelledby="activityPanelLable" aria-hidden="true">
    <div class="modal-dialog modal-xl" id="activityBox" >
      
    </div>
  </div>



<!-------------------------------------------------->


<script src="https://code.jquery.com/jquery-3.7.1.js"></script>  
<script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>

<script>
    new DataTable('#leads-data', {
        pagingType: 'simple_numbers'
    });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $(document).on("click", ".fetch-lead-details", function(e) {
       
            e.preventDefault();
            var leadId = $(this).data('lead-id');
            console.log(leadId)
            fetchLeadDetails(leadId);
        });

        function fetchLeadDetails(leadId) {
            $.ajax({
                url: '/leadActivity_data/' + leadId + '/',  // URL to fetch lead data
                type: 'GET',
                success: function(response) {
                    $('#activityBox').html(response);  // Place the result in activityBox
                    $('#activityPanel').modal('show');  // Show the modal
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        }
    });

</script>



{% endblock %}